<div id="deleteModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg w-11/12 sm:w-1/3">
    <div class="p-6 text-center">
      <svg class="mx-auto mb-4 text-gray-400 w-12 h-12" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
      </svg>
      <h3 class="mb-5 text-lg font-normal text-gray-500">Are you sure you want to delete this product?</h3>
      <button id="confirmDeleteButton" type="button" class="text-white bg-red-600 hover:bg-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center mr-2">
        Yes, I'm sure
      </button>
      <button onclick="hideDeleteModal()" type="button" class="text-gray-500 bg-white hover:bg-gray-100 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900">
        No, cancel
      </button>
    </div>
  </div>
</div>

<script>
  // untuk simpan id product to be deleted
  let productIdToDelete = null;

  function showDeleteModal(productId) {
    productIdToDelete = productId;
    document.getElementById('deleteModal').classList.remove('hidden');
  }

  function hideDeleteModal() {
    productIdToDelete = null;
    document.getElementById('deleteModal').classList.add('hidden');
  }

  // event listener untuk tombol konfirmasi hapus
  document.getElementById('confirmDeleteButton').addEventListener('click', async () => {
    if (!productIdToDelete) return;

    // ambil csrf token
    const csrftoken = getCookie('csrftoken');
    const deleteUrl = `{% url 'main:delete_product_ajax' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', productIdToDelete);

    try {
      const response = await fetch(deleteUrl, {
        method: "POST",
        headers: { "X-CSRFToken": csrftoken },
      });

      const result = await response.json();

      if (result.status === 'success') {
        showToast('Product has been deleted.', 'success'); // toast
        document.dispatchEvent(new CustomEvent('productDeleted')); // kirim sinyal
      } else {
        // error jika server gagal menghapus
        showToast(result.message || 'Failed to delete product.', 'error');
      }

    } catch (error) {
      console.error('Delete error:', error);
      showToast('An error occurred. Please try again.', 'error');
    } finally {
      hideDeleteModal();
    }
  });
</script>